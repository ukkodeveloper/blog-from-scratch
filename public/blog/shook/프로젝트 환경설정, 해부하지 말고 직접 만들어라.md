---
title: 프로젝트 환경설정, 해부하지 말고 직접 만들어라
date: 2023-08-10
tags: ['환경설정']
image: '/images/프로젝트를%20해부하지%20말고%20직접%20만들어라-20240125111732810.webp'
summary: 프론트엔드 환경설정을 하면서 느낀점들을 정리했습니다. 무엇을 했는가를 보여주기 보다는, 어떻게 접근했는가에 초점을 맞춰 설명했습니다.
published: true
---
프로젝트를 시작하면서 기본적인 환경설정을 해야했다. CRA, Vite와 같은 기본 환경을 제공해주는 도구 없이 진행해야만 했다. 이러한 도구 없이 환경 설정을 하게 되면, 정말 신경써야하는 것들이 많고 무엇부터 해야할 지 막막하다. 

빌드부터 린트 설정, 타입스크립트 설정 그리고 jest나 storybook이 실행될 수 있는 별도의 환경도 설정해주어야 한다. 또한 lint와 prettier 설정도 해주어야 하며, 하위 호환성을 위해 babel을 사용하는 것도 고려해봐야 한다. 또한 디렉터리 구조도 생각해야 하며, 정적인 asset은 어떻게 관리해야할 지도 고민해봐야 한다. (정말 할 게 많은데도 이 정도가 기본적인 세팅이라 할 수 있겠다.)

물론, 이미 환경설정을 해봤기 때문에 무얼 해야하는지 나열할 수 있는 것이다. **처음에 "프로젝트를 위한 환경설정"을 해야한다고 했을 때, 무엇부터 해야할지 감도 오지 않았다.** 

**이 글은 너무 광범위하거나 생소해서 무얼 해야할 지 감이 오지 않을 때, 어떻게 접근할 수 있는지를 다룬 글이다.** "CRA 없이 리액트 시작하기" 라고 검색하면 '다음 순서대로 적용하면 환경설정을 할 수 있다'는 글은 많다. (정말 순서대로 하면 잘 된다.) 하지만 어떻게 접근하여 환경 설정을 할 수 있을 지에 대한 '고민'이 드러난 글은 많진 않은 것 같다. 그래서 세부적인 환경설정 방법보다는 '접근'에 초점을 마추어 글을 썼다.

따라서 당장 적용할 수 있는 코드가 필요한 것이라면, 우리 팀에서 작성한 위키를 확인하면 좋을 것 같다. 혹은 "CRA 없이 리액트 시작하기" 를 검색하면 많은 글을 볼 수 있다.

[실제 프로젝트에 적용한 코드](https://github.com/woowacourse-teams/2023-shook/wiki/%ED%94%84%EB%A1%A0%ED%8A%B8%EC%97%94%EB%93%9C-%ED%98%84%EC%9E%AC-%ED%99%98%EA%B2%BD-%EC%84%A4%EC%A0%95)

## 왜 "직접" 하나요?

프로젝트 환경설정을 하기 전에 "목적"부터 고려해보면 좋을 것 같다. 당연히 코드를 작성하려면 환경 설정을 해야한다만, 왜 굳이 CRA나 Vite를 사용하지 않는 것인가? 라고 생각할 수도 있다.

사실 웹팩을 사용해서 밑바닥부터 시작하는 일은 이미 잘 돌아가는 바퀴를 재발명하는 꼴에 가깝다고 생각한다. 즉, 프로젝트를 위한 일은 아니다. 그럼에도 우리는 너무 당연하게 여겼던 것들(그 중 대표적으로 빌드 과정이 있다)을 직접 만들어보면서 그 과정을 이해하기 위함에 있다.

> Don't dissect the frog, build it

개구리를 해부하지 말고 직접 만들라는 뜻이다. 무언가를 배울 때 직접 해봐야 제대로 이해할 수 있다는 것이다. 직접 환경설정을 설계하고 적용해보면서 다양한 문제를 겪고 더 깊이 이해할 수 있는 것이 해당 작업의 목적이라 할 수 있겠다. (즉, 진짜 프로젝트를 제대로 관리하고 싶으면 잘 만들어진 CRA나 Vite, 만약 SSR을 한다면 Next와 같은 프레임워크를 사용하면 된다고 생각한다. )

## 설정 목록화 하기

우선 가장 먼저 설정해야할 것들을 목록화하는 것이었다. 막연할 수록 잘게 나누어 보고 하나씩 적용하다보면 완성되기 마련이라 생각한다. 하지만, 이번 환경설정의 경우는 뭘 해야하는 지도 막막한 상황이었다. 

### 막막하게 만든 요인 찾기

사실 환경설정이라고 하면 린트나 프리티어 설정, 내가 사용하는 패키지 설치 정도는 익숙하다. 그렇다면 진짜 막막하게 만드는 요인이 무엇인지 찾아야 한다. 나의 경우는 '빌드'였다. CRA나 Vite를 사용했던 경험으로는 `npm run start` 를 하면 dev모드에서 프로젝트를 로컬에서 확인할 수 있었다. 또한 `npm run build`를 하면 자동으로 파일이 빌드되어 컴파일링 되었다. 

즉, 만약 내가 당연하게 자동으로 사용하고 있던 기능이었기에 막막했다고 생각했다. 그래서 내가 이제껏 당연하게 생각했던 것들을 적어 내려 보기로 했다.

## 당연하게 사용한 기능 찾기

1. npm run start를 하면 dev 모드에서 프로젝트가 실행되었다.
2. npm run build를 하면 빌드 파일이 생성되었다.
3. dev 모드에서 코드를 변경하면, 새로고침하지 않아도 렌더링에 반영이 되어 있다.
4. 심지어 React 상태도 그대로 보존되어 있다.
5. 환경 변수도 .env파일에 정의만 해두면 사용할 수 있었다.
6. Jest도 바로 사용할 수 있었다. 

이외에도 많겠지만, 당장 생각나는 것들을 적어내렸다.

## 진짜 해야할 것 목록화하기

드디어 "뭘 해야할 지 모르겠어요"에서 "뭘 해야하는 지는 알겠어요. 구체적으론 모르겠지만." 상황이 되었다.

그렇다면 이제 해야할 것을 목록화한 다음 하나씩 부수면 된다. (무엇인지 알았다면 구체적인 것은 어떻게든 해결할 수 있다고 생각한다.)

해야하는 일은 다음과 같다.

- 빌드 환경 설정하기
	- webpack을 통해 dev와 prod 모드 구분하기
	- dev 모드에서 HMR 활성화하기
	- 정적 파일 서빙하기
- eslint, prettier 설정하기
- Jest와 StoryBook 환경 설정하기

## 구현하면서 명심할 것들

목록을 만들고 큰 그림을 그려냈다면 이제 하나씩 적용을 하면 된다. 말은 쉽지만 사실 이게 정말 쉽지 않은 부분이긴 하다. 때로는 예상처럼 작동하지 않을 때도 많았고, 생각지도 못한 부분도 적용해야할 것도 생겼다. 

그럴때마다 내가 했던 실수를 바탕으로 어떻게 현명하게 접근해야하는 지, 생각을 정리해보았다.

### 차분히 익히기

때론 구현 항목을 하나씩 쳐내다보면, 조급하게 특정 문제만 해결하려고 애쓰게 되는 경우가 있었다. 그렇다 보면 핵심을 잃게 되고, 내가 해야하는 항목과 특정 패키지나 플러그인이 하는 역할을 명확하게 구분할 수 없게 된다.

예를 들어, 현재 webpack 환경에서 javascript 하위 호환성을 보장하기 위한 작업을 할 때였다. 그때 바벨을 사용해야하는 것인지, tsconfig의 target 필드로도 가능한 것이 너무 모호했다.  그 때 빠르게 적용하기 위해서 "그래서 뭘 어떻게 해야하는 건데?" 에만 집중하다보니 핵심을 놓치게 되었다.

그 과정에서 차분히 'syntax 변환'과 'polyfill'을 학습해야 했다. 또한 tsc와 babel이 어떤 역할을 하는 지 비교 대조를 하는 것이다. 해당 패키지에서 제공해주는 기능을 담백하게 이해하는 것이 우선이었던 것이다.

### 큰 그림 잃지 않기

너무 지엽적인 것에 빠져서 본질을 놓치면 안된다. 환경설정을 하다보니 생소한 영역이 많아서 이해가 되지 않는 설정들이 많았다. 예를 들면, HMR을 지원하기 위해 ReactRefreshWebpackPlugin을 적용했는데 이해가 되지 않았다. 플러그인 하나 사용하는 것으로 해결이 되니 찝찝한 마음에 이것저것 찾아보았다. (물론 제대로 이해할 수 없었다.) 

제대로 동작하는 한 사이클을 빠르게 경험하는 것이 중요하다고 느꼈다. 현재 내 수준에서 이해하기 힘들거나 시간이 많이 필요한 부분은 때론 잠시 미뤄두는 것도 필요하다. 그래야 길을 잃지 않고 돌아가는 무언가를 만들 수 있다.

### 기본적인 지식은 반드시 채우기

환경 설정을 하다보니 기본을 알아야만 이해하기 쉬운 것들이 있다. 반복해서 나온다거나 큰 흐름을 이해하는 데 필요한 지식이 기본 지식이다. 이러한 것들은 반드시 명확하게 채우고 넘어가는 편이 좋다. 

예를 들면 경로나 모듈 시스템이 될 수 있다. 처음 경로에 대해서 학습이 필요하다고 느꼈던 이유는 웹팩의 entry는 상대경로로, output은 절대 경로로 되어 있는 예시가 많았기 때문이다. 상대, 절대 경로가 무엇인진 알지만 언제 사용해야하는지는 깊게 고려해본 적이 없었다. 경로는 한번 제대로 익히면 환경 설정할 때 계속 반복되기 때문에 익혀 놓으니 편한 부분이 많았다. 

모듈 시스템도 마찬가지다. 호환성뿐만 아니라 다양한 모듈 관련 이슈들이 있다. 예를 들어 ts-loader을 사용할 경우 tsconfig에서 CJS 모듈로 컴파일한다면 tree-shaking이 안된다. 이러한 것에 대처하기 위해 모듈 시스템도 명확하게 파악하는 것이 다양한 항목에서 설정할 때 도움이 된다.

## 끝으로

앞서 말했듯, 해당 작업들은 개구리를 분석하는 게 아니라 직접 만들어보는 것이 핵심이다. 단순히 분석이라면 어떤 설정을 줘야하는지, 그에 필요한 개념은 무엇인지 이해만 하면 된다.

하지만, 직접 만들어보는 과정을 통해서 관련된 지식 뿐만 아니라 어떻게 접근해야하는지도 배울 수 있었다. 그 과정에서 아쉬웠던 점들이 있었고 이를 느낄 수 있어서 좋은 경험이었다.

그 중에서 가장 중요하게 느꼈던 부분은 '관심사'를 분리하라는 것이다. 이건 코드를 작성할 때만 적용되는 말이 아니라는 걸 알았다. 내가 지금 적용해야하는 것에 사로 잡혀서 해당 패키지가 하는 역할을 오해석하면 안된다. 이번 작업에서 이런 경우가 잦았는데, 온전히 패키지의 역할을 파악하는 것이 우선이고 그 다음이 나에게 적용할 수 있는가를 고민해야한다는 것을 느꼈다. 이걸 깨달으니 왜 프로그래밍에서 정답은 없다라고 하는 지도 알 것 같았다. 